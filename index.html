<script>
    function updateImage() {
        const inputEl = document.getElementById('studentId');
        const input = inputEl.value.trim();

        if (!input) {
            document.getElementById('studentImage').src = '';
            hideError();
            return;
        }

        const id = input.toUpperCase();
        inputEl.value = id;

        const url = `https://iare-data.s3.ap-south-1.amazonaws.com/uploads/STUDENTS/${id}/${id}.jpg`;
        document.getElementById('studentImage').src = url;
        hideError();
    }

    function showError() {
        document.getElementById('error').style.display = 'block';
    }

    function hideError() {
        document.getElementById('error').style.display = 'none';
    }

    // -------- NEXT number logic --------
    function getNextSuffix(suffix) {
        const [c1, c2] = suffix;
        const isDigit = ch => ch >= '0' && ch <= '9';
        const isLetter = ch => ch >= 'A' && ch <= 'Z';

        if (isDigit(c1) && isDigit(c2)) {
            const num = parseInt(suffix, 10);
            return num < 99 ? String(num + 1).padStart(2, "0") : "A0";
        }

        if (isLetter(c1) && isDigit(c2)) {
            if (c2 < '9') return c1 + (parseInt(c2) + 1);
            return c1 < 'Z'
                ? String.fromCharCode(c1.charCodeAt(0) + 1) + "0"
                : "00";
        }

        return suffix;
    }

    // -------- PREVIOUS number logic --------
    function getPreviousSuffix(suffix) {
        const [c1, c2] = suffix;
        const isDigit = ch => ch >= '0' && ch <= '9';
        const isLetter = ch => ch >= 'A' && ch <= 'Z';

        if (isDigit(c1) && isDigit(c2)) {
            const num = parseInt(suffix, 10);
            return num > 0 ? String(num - 1).padStart(2, "0") : "Z9";
        }

        if (isLetter(c1) && isDigit(c2)) {
            if (c2 > '0') return c1 + (parseInt(c2) - 1);
            return c1 > 'A'
                ? String.fromCharCode(c1.charCodeAt(0) - 1) + "9"
                : "99";
        }

        return suffix;
    }

    function goToNextRoll() {
        const inputEl = document.getElementById('studentId');
        let id = inputEl.value.trim().toUpperCase();
        if (id.length < 2) return;

        const prefix = id.slice(0, -2);
        const suffix = id.slice(-2);

        inputEl.value = prefix + getNextSuffix(suffix);
        updateImage();
    }

    function goToPreviousRoll() {
        const inputEl = document.getElementById('studentId');
        let id = inputEl.value.trim().toUpperCase();
        if (id.length < 2) return;

        const prefix = id.slice(0, -2);
        const suffix = id.slice(-2);

        inputEl.value = prefix + getPreviousSuffix(suffix);
        updateImage();
    }

    // Keyboard navigation
    document.getElementById('studentId').addEventListener('keydown', function (e) {
        if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
            e.preventDefault();
            goToNextRoll();
        }
        if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
            e.preventDefault();
            goToPreviousRoll();
        }
    });
</script>
